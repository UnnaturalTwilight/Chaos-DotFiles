
;; Panels

(defwindow user
  :monitor 0
  :stacking "fg"
  :geometry (geometry :x "40px" :y "40px"
    :width "360px" :height "400px"
  :anchor "top right")
  (profile))

(defwindow system
  :monitor 0
  :stacking "fg"
  :geometry (geometry :x "40px" :y "40px"
    :width "360px" :height "725px"
  :anchor "bottom right")
  (month))

(defwidget profile []
  (box :class "startPanel" :orientation "v" :space-evenly false :spacing -10
    (box :class "picbox" :halign "fill" :valign "start" :space-evenly false :hexpand true :spacing 10
      (image :path "../profilepic.png" :image-width 150)
      (box :orientation "v" :space-evenly false :valign "center" :halign "fill" :spacing 10 :hexpand true :class "hostname"
        (padding :space 10 :vspace 10 :expand true)
        (label :text "${get_env('USER')}@${debug ? "--debug--" : "underkill"}" :halign "start") ;Hard coded cause why not
        (box :hexpand false :space-evenly false
          (label :text {replace(replace(wifi, ":.*",""), "Wired connection", "Ethernet")} :halign "start" :hexpand true :truncate true)
          ;; replace with better code later
          (box :halign "end" :hexpand false :space-evenly false :spacing 10
            (tooltip (label :text "Tunnel" :class "tooltip")
              (label :text {replace(wifi, ".*:.?tun.*","󰒃")} :visible {matches(wifi, ".*:.?tun.*")}))
            (tooltip (label :text "Wifi" :class "tooltip")
              (label :text " "))))
        (box :hexpand false :space-evenly false :class "systray" :halign "end" :spacing 10
          (systray :orientation "h" :icon-size 20 :spacing 10 :space-evenly false :halign "end")
          (button :onclick "$HOME/Monolith/birdmanager/launch-or-summon.sh" :class "trayicon" " "))))
    (box :orientation "h" :space-evenly true :class "icons" :halign "center" :valign "end" :spacing 40 :hexpand true :vexpand true
      (tooltip (label :text "Shutdown" :class "tooltip") (button :onrightclick "systemctl poweroff" :onmiddleclick "systemctl poweroff -i" ""))
      (tooltip (label :text "Reboot" :class "tooltip") (button :onrightclick "systemctl reboot" ""))
      (tooltip (label :text "Suspend" :class "tooltip") (button :onrightclick "launch-start close && systemctl suspend" "󰤄"))
      (tooltip (label :text "Lock" :class "tooltip") (button :onrightclick "launch-start close && loginctl lock-session" ""))
      (tooltip (label :text "logout" :class "tooltip") (button :onrightclick "launch-start close && hyprctl dispatch exit" ""))
    )
    (box :class "stat-tiles" :orientation "v" :space-evenly true :valign "end" :class "stat-tiles" :spacing 10 :vexpand true
      (tile_batt :status {EWW_BATTERY.BAT1.status} :value {EWW_BATTERY.BAT1.capacity})
      (tile_volume)
    )))

(defwidget month []
  (box :class "startPanel" :orientation "v" :space-evenly false :vexpand true :valign "fill"
    ; (box :class "calbox" :orientation "v" :space-evenly false :valign "start" :vexpand false
      ; (label :text {formattime(EWW_TIME, "%H:%M:%S" )} :class "clock")
      ; (label :text {formattime(EWW_TIME, "%B %d, %Y" )} :class "local")
      ; (calendar :class "cal"))
    (notifcenter)
    (stats)))

(defwidget stats []
  (box :class "startPanel" :orientation "v" :space-evenly false :spacing -5 :valign "end"
    (box :orientation "v" :space-evenly false :valign "end" :class "stat-tiles" :spacing 10
      (tile_combo)
      (for disk in {mntpoints}
        (tile_disk :char {disk.name ?: disk.mount}
          :icon {disk.icon} :filesystem {disk.fs}
          :mountpoint {disk.mount} :device {disk.dev})
      ))
  ))
